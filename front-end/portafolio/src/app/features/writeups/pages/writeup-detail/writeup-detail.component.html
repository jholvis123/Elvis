<ng-container *ngIf="!loading && writeup">
<div class="writeup-detail-page">
    <!-- Reading Progress Bar -->
    <div class="reading-progress-bar" [style.width.%]="readingProgress()"></div>

    <!-- Table of Contents (Lateral Navigation) -->
    <app-table-of-contents
        [items]="tocItems()"
        [stats]="tocStats()"
        [activeId]="activeHeadingId"
        (itemClick)="onTocItemClick($event)"
        (stateChange)="onTocStateChange($event)"
    ></app-table-of-contents>

    <!-- Main Content Area -->
    <main class="writeup-main-content" [class.toc-open]="tocOpen()">
        <!-- Header -->
        <header class="writeup-header">
            <div class="header-top">
                <a routerLink="/writeups" class="back-link">
                    <span>â†</span>
                    <span>Writeups</span>
                </a>
                
                <div class="admin-actions" *ngIf="authService.isAdmin">
                    <a [routerLink]="['/writeups', writeup.id, 'edit']" class="btn-icon" title="Editar">
                        âœï¸
                    </a>
                    <button *ngIf="writeup.status === 'draft'" (click)="publishWriteup()" class="btn-icon success" title="Publicar">
                        âœ…
                    </button>
                    <button (click)="deleteWriteup()" class="btn-icon danger" title="Eliminar">
                        ğŸ—‘ï¸
                    </button>
                </div>
            </div>
            
            <div class="header-content">
                <div class="header-meta">
                    <span *ngIf="writeup.status === 'draft'" class="badge badge-warning">ğŸ“ Borrador</span>
                    <a *ngIf="writeup.ctf_id" [routerLink]="['/ctf', writeup.ctf_id]" class="badge badge-ctf">
                        ğŸ¯ Ver CTF
                    </a>
                </div>
                
                <h1 class="writeup-title">{{ writeup.title }}</h1>
                
                <p *ngIf="writeup.summary" class="writeup-summary">{{ writeup.summary }}</p>
                
                <div class="writeup-stats">
                    <span class="stat">
                        <span class="stat-icon">ğŸ“–</span>
                        <span>{{ writeup.read_time }} min</span>
                    </span>
                    <span class="stat">
                        <span class="stat-icon">âœï¸</span>
                        <span>{{ writeup.word_count || 0 }} palabras</span>
                    </span>
                    <span class="stat">
                        <span class="stat-icon">ğŸ‘ï¸</span>
                        <span>{{ writeup.views }} vistas</span>
                    </span>
                    <span class="stat">
                        <span class="stat-icon">ğŸ“…</span>
                        <span>{{ writeup.created_at | date:'dd MMM yyyy' }}</span>
                    </span>
                </div>
            </div>
            
            <!-- Tools & Techniques Tags -->
            <div class="writeup-tags" *ngIf="writeup.tools_used.length > 0 || writeup.techniques.length > 0">
                <span class="tag tag-tool" *ngFor="let tool of writeup.tools_used">ğŸ› ï¸ {{ tool }}</span>
                <span class="tag tag-technique" *ngFor="let tech of writeup.techniques">ğŸ’¡ {{ tech }}</span>
            </div>
            
            <!-- Languages Used -->
            <div class="writeup-languages" *ngIf="writeup.languages_used && writeup.languages_used.length > 0">
                <span class="languages-label">CÃ³digo:</span>
                <span class="language-badge" *ngFor="let lang of writeup.languages_used">{{ lang }}</span>
            </div>
        </header>
        
        <!-- Content with Markdown Viewer -->
        <app-markdown-viewer
            [html]="writeup.content_html"
            [content]="writeup.content"
        ></app-markdown-viewer>
    </main>
</div>
</ng-container>

<!-- Loading -->
<div class="loading-container" *ngIf="loading">
    <div class="loading-spinner"></div>
    <p>Cargando writeup...</p>
</div>

<!-- Error -->
<div class="error-container" *ngIf="error && !loading">
    <span class="error-icon">âš ï¸</span>
    <p class="error-message">{{ error }}</p>
    <a routerLink="/writeups" class="error-link">Volver a writeups</a>
</div>
